name: Discord Release Notifier

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Release Info to Discord
        env:
          DISCORD_WEBHOOK_URL_1: ${{ secrets.DISCORD_WEBHOOK_URL_1 }}
        run: |
          # Truncate release notes to avoid Discord limit (4000 chars safe)
          BODY=$(echo "${{ github.event.release.body }}" | head -c 4000)

          curl -X POST "$DISCORD_WEBHOOK_URL_1" \
            -H "Content-Type: application/json" \
            -d @- << EOF
          {
            "username": "GitHub Releases",
            "avatar_url": "https://github.com/github.png",
            "embeds": [
              {
                "title": "ðŸš€ New Release: ${{ github.event.release.name }}",
                "url": "${{ github.event.release.html_url }}",
                "description": "$BODY\n\nðŸ”— **Read full changelog on GitHub**",
                "color": 5814783,
                "author": {
                  "name": "${{ github.event.release.author.login }}",
                  "url": "${{ github.event.release.author.html_url }}",
                  "icon_url": "${{ github.event.release.author.avatar_url }}"
                },
                "footer": {
                  "text": "JsWeb Framework"
                }
              }
            ]
          }
          EOF
